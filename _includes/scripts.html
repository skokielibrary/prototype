<script src="{{ site.baseurl }}/js/vendor/jquery.js"></script>
<script src="{{ site.baseurl }}/js/foundation.min.js"></script>
<script type="text/javascript">
    setTimeout(function(){var a=document.createElement("script");
    var b=document.getElementsByTagName("script")[0];
    a.src=document.location.protocol+"//dnn506yrbagrg.cloudfront.net/pages/scripts/0022/2912.js?"+Math.floor(new Date().getTime()/3600000);
    a.async=true;a.type="text/javascript";b.parentNode.insertBefore(a,b)}, 1);
</script>
<script>
  $(document).foundation();
</script>
<script src="http://us.libraryh3lp.com/presence/jid/redesign/chat.libraryh3lp.com/js" + new Date().getTime()></script>
{% if page.title == 'Events' %}
<script src="{{ site.baseurl }}/js/vendor/handlebars-v2.0.0.js"></script>
<script>

    // Catch filter onclicks
    document.getElementById("kid-filter").onclick = function(){
      filterEvents('kid-event');
    };
    document.getElementById("adult-filter").onclick = function(){
      filterEvents('adult-event');
    };
    document.getElementById("teen-filter").onclick = function(){
      filterEvents('teen-event');
    };
    document.getElementById("family-filter").onclick = function(){
      filterEvents('family-event');
    };
    document.getElementById("all-ages-filter").onclick = function(){
      filterEvents('all-ages-event');
    };

    document.getElementById("show-all-filter").onclick = function(){
      showAll();
    };

    function filterEvents(filter) {
      // hide all events
      var events = document.getElementsByClassName('event'), i;
      for (var i = 0; i < events.length; i ++) {
        events[i].style.display = 'none';
      }
      // show events filtered
      var filter_events = document.getElementsByClassName(filter), i;
      for (var i = 0; i < filter_events.length; i ++) {
        filter_events[i].style.display = 'block';
      }
    }

    // show all events
    function showAll() {
      var events = document.getElementsByClassName('event'), i;
      for (var i = 0; i < events.length; i ++) {
        events[i].style.display = 'block';
      }
    }

</script>
{% endif %}
<script>
    $(document).ready(function(){

        $('#search-query').focus();

        var current = new Date().getTime();
        var presence_url = 'http://us.libraryh3lp.com/presence/jid/redesign/chat.libraryh3lp.com/js';

        var initialize_chat = function(){
            $.getScript(presence_url, function(){
                if (jabber_resources[0].show === 'available' || jabber_resources[0].show === 'chat'){
                    $('#library-chat-button').animate({'bottom' : '0'}).addClass('chat-closed');
                    $('#library-chat-widget').animate({'bottom': '-352px'});

                    $('#library-chat-button').click(function(){
                        if ($(this).hasClass('chat-closed')) {
                          $('#library-chat-widget').animate({'bottom' : '0', 'width': '300px'});
                          $('#library-chat-button').animate({'bottom': '354px'});
                        } else {
                          $('#library-chat-widget').animate({'bottom': '-352px', 'width': '210px'}, 'fast');
                          $('#library-chat-button').animate({'bottom': '0'}, 'fast');
                        }

                        $(this).toggleClass('chat-closed').toggleClass('chat-opened');
                    });
                }
                else{
                    $('#library-chat-button').hide();
                    $('#library-chat-widget').hide();
                }
            });
        }

        initialize_chat();
        window.setInterval(initialize_chat, 120000);

        var cal = []
        var cal_dates = [];

        $.getJSON('http://localhost/tools/feed/?jsoncallback=?', function(data){

                $.each(data.item, function(i){
                    var item = data.item[i];
                    if ( cal_dates.indexOf(item.date1) === -1 ){
                        cal_dates.push(item.date1);
                        cal[item.date1] = [];

                    }
                    cal[item.date1].push(item);
                });

                for ( i in cal_dates ){
                    console.log(cal_dates[i], cal[cal_dates[i]]);
                }
        });

    });
</script>
